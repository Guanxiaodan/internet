# 互联网协议入门
> 参考：http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html
## 概述

### 五层模型
####（偏向于硬件）实体层--->链接层--->网络层--->传输层--->应用层（偏向于用户）

### 实体层
把电脑连接起来的物理手段。例如光缆，电缆，双绞线，无线电波等方式。
作用是负责传输 **0和1** 的电信号。

### 链接层
#### 以太网
单纯的 0和1 没有任何意义， 所以链接层主要是确定 0和1 的**分组方式**。
一种叫 **"以太网"** 的协议，占据了分组方式的主导地位。

以太网规定，一组电信号构成一个数据包，叫做一 **"帧"** ，一帧分为**标头（Head）** 和 **数据（Data）**。

标头：数据包的说明项，比如 **发送者、接收者**、数据类型等。

数据：数据包的具体内容。

#### MAC地址
上面说到发送者和接收者，那么他们是如何被标识的呢？
 
 答：以太网规定所有接入网络的设备，都必须有**网卡**接口，也就是说数据包是从一个网卡传输到另一个网卡，
 网卡的地址就叫**MAC地址**，这就是数据包的发送地址和接受地址。
 每块网卡的地址都是世界上 *独一无二* 的，用12个十六进制数表示。
 
 #### 广播
 那么发送方网卡怎么知道接收方网卡的MAC地址？
 
 答：有一种叫ARP的协议（后面说），可以解决这个问题。这里只要了解到以太网数据包必须知道接收方的MAC地址才能发送就好。
 
 现在有了MAC地址，系统怎样才能把数据包准确传输给接收方？
 
 答：以太网采用了一种原始的方式：以太网项本网络的所有计算机发送数据包，每台电脑自己判断自己是不是接收方。
 如果标头的接收方MAC地址和自己的Mac地址匹配上了，就接受数据包，否则就丢弃数据包。这种发送方式就叫做**"广播"**。
 
 ##### 有了数据包，发送和接受的Mac地址，以及广播的发送方式，链路层就可以在多台计算机之间传输数据了。
 
 ### 网络层
 #### 由来
上面那种广播的方式，不仅效率低，而且局限在发送者所在的局域网。
所以，如光想让北京的计算机给洛杉矶的计算机发一封邮件，几乎是不可能的，因为北京和洛杉矶出于同一个局域网的可能性几乎没有。

所以得找到一种方法，能后区分那些Mac地址属于同一个子网络，哪些不是。如果在同一个子网络，就用广播的方式发送，否则就用**路由**的方式发送。
（路由就是指如何向不同的子网络发送数据包）。但是Mac无法做到，他只能区分厂家，无法区分网络。
所以，就导致了**网络层**的诞生。
##### 网络层的作用是引进一套新的地址，利用这套地址可以使我们看出来不同的计算机是否属于同一个**子网络**，指套地址就叫做网络地址，简称'网址'。

 这网络层出现后，每台计算机就有了两种地址：**Mac地址**和**网络地址**，这两种地址之间没有任何联系。MAC地址是绑定在网卡上的，网络地址是管理员分配的。
 
 ##### 于是乎：网址帮我们确定计算机所在的子网络，然后MAC地址将数据包送到子网络中的目标网卡。
 
 #### IP
 规定网络地址的协议称为**IP协议**，，他所定义的地址就称为IP地址（其实就是网址）；
 
 目前采用的IP协议是第四版（IPv4），这个版本规定网络地址由32个二进制位组成。我们一般用分成四段的十进制数表示IP地址（0.0.0.0~~255.255.255.255）
 
 互联网上的每一台计算机都会被分到一个IP地址，IP地址前一部分表示网址（比如是前16位，当然也可能是前24位，那主机就是后8位），后一部分表示主机（那就是后16位）。**处于同一个子网络的计算机，他们的IP地址的网络部分一定是相同的**。
 
 那么怎么知道两台计算机是否处于同一个子网络呢（因为我不知道他这个子网络的网络地址是IP的前多少位）？这就用到了**子网掩码**，
 
  子网掩码时表示子网络特征的一个参数，形式上和IP相同。他就可以区分网络地址是前多少位（用1表示），主机们是后几位（用0表示）。比如一个IP地址为192.168.31.212，它的网络部分是前24位，那么它的子网掩码就是 11111111.11111111.11111111.00000000，
  写成十进制就是255.255.255.0；
  
  所以，**知道子网掩码，我们就能知道任意两个IP地址是否处于同一子网络**。
  所以，IP地址的作用有两个： **一个是为每一台计算机分配IP地址，另一个是确定哪些地址在同一个子网络**。
  
  
  #### IP数据包
  
  根据IP协议发送的数据包，叫**IP数据包**（当然里面包含了IP地址）。
  
  前面说的以太网数据包只包含MAC地址，没有IP地址放的位置，难道发数据的时候还得以太网一个包，IP一个包么？
  
  答：不用。只需要将IP数据包放到以太网包的"数据"部分就可以了。
  
  IP数据包呢，也含有标头和数据两部分：
  
  标头：版本，长度，IP地址等信息，
  
  数据：就是IP数据包的具体内容了。
  
  所以，以太网的数据包就成了这样子：{标头：{}， 数据：{IP标头：{}，IP数据：{}，其他数据：{}}}。
  前面说了以太网数据包有长度限制，那如果**IP的数据包太长**，超过了以太网的长度限制，那么IP的数据就要被分成好几个以太网的数据包**分别发送**了。
  
   
  #### ARP协议
  在网络上发数据包，需要知道对方的两个地址，就是前面说的MAC地址和IP地址。通常情况下，IP地址是已知的（后面解释），但是我们不知道对方的MAC地址。
  
  那我们如何获取到MAC地址呢？ 答： 从IP地址上获取。
  
  这里就分情况了：
  
   情况一：
   
   ##### 两台计算机不在同一个子网络
   
   那就没办法了获取到Mac地址了，只能把数据包传到链接两个子网络的节点：**网关**，让网关去处理。
   
   情况二：
   
   ##### 两台计算机属于同一个子网络
   
   使用**ARP协议**，得到对方的Mac地址，然后通过广播的方式，把以太网数据包发出去，每个计算机自行比较是否匹配。
   
   这具体是一个什么情况？
   
   答：ARP协议会发出一个数据包（放在以太网数据包中），其中包含了对方的IP地址，在对方的Mac地址一栏，写的是FF:FF:FF:FF:FF:FF,表示这是一个广播地址。每一个计算机收到这个数据包后，取出来包里面的IP地址，与自己的IP地址进行比较，如果相同，就向对方报告自己的Mac地址。这样就通过IP和ARP协议获取到了接收方的MAC地址。不匹配则丢弃这个包。
   
   所以，**有了ARP协议，我们就可以得到同一个子网络内的主机MAC地址，就可以把数据包发送到子网内任意的计算机上了**
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  